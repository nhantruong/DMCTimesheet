@model IEnumerable<DMCTimesheet.Models.C14_Services>
@{
    ViewBag.Title = "Services Manage Page";
    int stt = 1;
    int stt2 = 1;
    List<DMCTimesheet.Models.C15_SubConServices> CompanyService = ViewBag.CompanyService as List<DMCTimesheet.Models.C15_SubConServices>;
    List<DMCTimesheet.Models.C12_SubContractor> CompanyName = ViewBag.CompanyName as List<DMCTimesheet.Models.C12_SubContractor>;
    List<DMCTimesheet.Models.C22_ServiceGroup> ServiceGroups = ViewBag.ServiceGroups as List<DMCTimesheet.Models.C22_ServiceGroup>;
    // List<DMCTimesheet.Models.C14_Services> Services = ViewBag.Service as List<DMCTimesheet.Models.C14_Services>;

}
@* Modal create new *@
<h3 class="text-danger">@ViewBag.Error</h3>

@* Form nhập liệu *@
<div id="form" class="modal fade" role="dialog">
    <div class="modal-dialog modal-m">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Thêm dịch vụ</h3>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                @using (Html.BeginForm("CreateNewService", "Setting", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    <form>
                        <div class="form-group row">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3">Chọn Nhóm dịch vụ</lable>
                            <select name="ServiceGroupId" class="form-control col-md-7">
                                <option value="1">@ServiceGroups.FirstOrDefault(s => s.Id == 1).ServiceGroupName</option>
                                <option value=""></option>
                                @foreach (var ser in ServiceGroups.OrderBy(s => s.ServiceGroupName))
                                {
                                    <option value="@ser.Id">@ser.ServiceGroupName</option>
                                }
                            </select>
                        </div>
                        <div class="form-group row text-left text-dark">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3">Tên dịch vụ</lable>
                            <input type="text" class="form-control col-md-7 col-sm-9 col-xs-9" name="ServiceName" placeholder="Tên dịch vụ" required="" value="" />
                        </div>

                        <br />
                        <div class="clearfix"></div>

                        <div class="form-group text-left">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3 text-left"></lable>
                            <input type="submit" value="Lưu thông tin" class="btn btn-success col-md-7" />
                        </div>
                    </form>
                }
            </div>
            <div class="modal-footer">
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>
@* End Form nhập liệu *@

@* Form nhập liệu *@
<div id="dichvuNTP" class="modal fade" role="dialog">
    <div class="modal-dialog modal-m">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dịch vụ NTP</h3>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                @using (Html.BeginForm("CreateNewCompanyService", "Setting", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    <form>
                        <div class="form-group row">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3">Ngày tạo</lable>
                            <input type="date" class="form-control  col-md-7 col-sm-7 col-xs-7" name="Date" placeholder="" required="" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
                        </div>
                        <div class="form-group row">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3">Tên Công ty</lable>
                            <select name="SubConId" class="form-control col-md-7">
                                <option value=""></option>
                                @foreach (var comp in CompanyName.OrderBy(s => s.ShortName))
                                {
                                    <option value="@comp.SubConId">@comp.ShortName</option>
                                }
                            </select>
                        </div>
                        <div class="form-group row">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3">Tên dịch vụ</lable>
                            <select name="ServiceId" class="form-control col-md-7">
                                <option value=""></option>
                                @foreach (var ser in Model.OrderBy(s => s.ServiceName))
                                {
                                    <option value="@ser.ServiceId">@ser.ServiceName</option>
                                }
                            </select>
                        </div>

                        <br />
                        <div class="clearfix"></div>

                        <div class="form-group text-left">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3 text-left"></lable>
                            <input type="submit" value="Lưu thông tin" class="btn btn-success col-md-7" />
                        </div>
                    </form>
                }
            </div>
            <div class="modal-footer">
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>
@* End Form nhập liệu *@


<div>
    <p class="text-danger">@ViewBag.SaveContent</p>
</div>

<div>
    <div class="col-md-4">
        <div class="row">
            <div class="col-md-7">
                <h5>
                    DANH MỤC CÁC DỊCH VỤ - <b>
                        @if (Model == null)
                        {
                            <b class="text-primary">0</b>}
                        else
                        {<b class="text-danger">@Model.Count()</b>}
                    </b>
                </h5>
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-warning btn-small text-right" data-toggle="modal" data-target="#form"><i class="fa fa-plus-circle"></i> Thêm Dịch vụ</button>
            </div>
        </div>
        @*Table area*@
        <div class="table-responsive">
            <table class="table table-borderless">
                <tr class="text-white" style="background-color:#000000">
                    <td class="col-sm-1" style="width:70px">STT</td>
                    <td class="col-sm-4">Tên nhóm</td>
                    <td class="col-sm-5">Tên dịch vụ</td>
                    <td class="col-sm-1">#</td>
                </tr>
            </table>
        </div>
        <div class="table-responsive" style="height:900px">
            <table class="table table-striped table-bordered">
                <tbody class="">
                    @if (Model == null || Model.Count() == 0)
                    {
                        <tr class="row">
                            <td class="col-sm-12">Chưa có thông tin</td>
                        </tr>
                    }
                    else
                    {
                        foreach (var item in Model.OrderBy(s => s.ServiceGroupId))
                        {
                            <tr class="row">
                                <td class="col-md-1 text-center" style="width:70px">@stt</td>
                                <td class="col-sm-4">
                                    @if (item.ServiceGroupId != null)
                                    {
                                        <a class="text-dark">@ServiceGroups.FirstOrDefault(s => s.Id == item.ServiceGroupId).ServiceGroupName</a>
                                    }
                                </td>
                                <td class="col-sm-5">
                                    @if (item.ServiceName != null)
                                    {
                                        <b>@Html.ActionLink(item.ServiceName, "EditService", "Setting", new { Id = item.ServiceId }, new { @class = "text-primary" })</b>
                                        @*<a class="text-dark">@item.ServiceName</a>*@
                                    }
                                </td>
                                @* Button *@
                                <td class="col-md-2">
                                    @Html.ActionLink(" ", "EditService", "Setting", new { Id = item.ServiceId }, new { @class = "fa fa-edit" })
                                    @Html.ActionLink(" ", "DeleteService", "Setting", new { Id = item.ServiceId }, new { @class = "fa fa-remove btn" })
                                </td>
                            </tr>
                            stt++;
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-md-8">
        <div class="row">
            <div class="col-md-8">
                <h5 class="text-center">
                    DANH MỤC CÁC DỊCH VỤ - <b>
                        @if (CompanyService == null)
                        {
                            <b class="text-primary">0</b>}
                        else
                        {<b class="text-primary">[@CompanyService.Count()] <span>dịch vụ</span> / [@CompanyName.Count()] <span>công ty</span> </b>}
                    </b>
                </h5>
            </div>
            <div class="col-md-2">
                <input type="search" name="searchdv" id="searchNtp" onchange="searchntp(this.value)" value="" class="form-control search-query" placeholder="tìm kiếm npt..." />
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-primary btn-small text-right" data-toggle="modal" data-target="#dichvuNTP"><i class="fa fa-plus-circle"></i>Thêm dịch vụ NTP</button>
            </div>
        </div>
        <div class="table-responsive col-md-12">
            <table class="table table-borderless">
                <tr class="text-white row" style="background-color:#000000">
                    <td class="col-sm-1">STT</td>
                    <td class="col-sm-2">Tên công ty</td>
                    <td class="col-sm-6">Dịch vụ cung cấp</td>
                    <td class="col-sm-2">Ngày cập nhật</td>
                    <td class="col-sm-1 text-center">#</td>
                </tr>
            </table>
        </div>
        <div class="table-responsive" style="height:900px">
            <table class="table table-striped table-bordered">
                <tbody class="">
                    @if (CompanyService == null || CompanyService.Count() == 0)
                    {
                        <tr class="row">
                            <td class="col-sm-1">Chưa có thông tin</td>
                        </tr>
                    }
                    else
                    {
                        foreach (var item in CompanyService.OrderBy(s => s.SubConId).GroupBy(s => s.SubConId))
                        {
                            @*using (Html.BeginForm("EditCompanyService", "Setting", FormMethod.Post))
                                {
                                    @Html.AntiForgeryToken();*@
                            <tr class="row">
                                <td hidden class="text-center">
                                    <input type="number" name="Id" value="@item.Key" />
                                </td>
                                <td class="col-sm-1 text-center">@stt2</td>
                                <td class="col-sm-2">
                                    <div class="form-group">
                                        <input type="text" class="form-control text-danger text-center" readonly name="SubConId_Name" placeholder="" required="" value="@CompanyName.FirstOrDefault(s=>s.SubConId == item.Key).ShortName" />
                                        <span class="text-primary">@CompanyName.FirstOrDefault(s => s.SubConId == item.Key).ContractorName</span>
                                    </div>
                                </td>
                                <td class="col-sm-8">
                                    @foreach (var itm in item.AsEnumerable().ToList())
                                    {
                                        <div class="form-group row">
                                            <div class="col-sm-8">
                                                <select disabled name="ServiceId" class="form-control col-sm-12">
                                                    @if (itm.ServiceId != null)
                                                    {
                                                        <option value="@itm.ServiceId">@Model.FirstOrDefault(s => s.ServiceId == itm.ServiceId).ServiceName</option>
                                                    }
                                                    @*<option value="@itm.ServiceId"></option>
                                                        @foreach (var ser in Model.OrderBy(s => s.ServiceName))
                                                        {
                                                            <option value="@ser.ServiceId">@ser.ServiceName</option>
                                                        }*@
                                                </select>
                                            </div>
                                            <div class="col-sm-4">
                                                <input readonly type="date" class="form-control" name="Date" placeholder="" required="" value="@itm.Date.Value.ToString("yyyy-MM-dd")" />

                                            </div>

                                        </div>

                                    }
                                </td>
                                <td class="col-sm-1">
                                    <div class="form-group text-left">
                                        @*<input type="submit" value="Lưu" class="btn btn-success" />*@
                                        <a>@Html.ActionLink("Xem", "EditNTP", "Setting", new { Id = item.Key }, new { @class = "btn btn-primary" })</a>
                                        @*<a>@Html.ActionLink("Xóa", "DeleteCompanyService", "Setting", new { Id = item.Key }, new { @class = "btn btn-danger" })</a>*@
                                    </div>
                                </td>
                            </tr>
                            stt2++;
                        }
                    }
                    @*}*@
                </tbody>
            </table>
        </div>
    </div>
</div>


