
@{
    ViewBag.Title = "Trang chủ";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
    DMCTimesheet.Models.C02_Members loginUser = Session["UserLogin"] as DMCTimesheet.Models.C02_Members;

    List<DMCTimesheet.Models.C01_Projects> myProject = ViewBag.MyProjects as List<DMCTimesheet.Models.C01_Projects>;
    List<DMCTimesheet.Models.C08_Timesheet> myWorks = ViewBag.MyWorks as List<DMCTimesheet.Models.C08_Timesheet>;
    //List<DMCTimesheet.Models.C08_Timesheet> myWorks = _myWorks.Take(10);
    List<DMCTimesheet.Models.C07_WorkType> Worktype = ViewBag.WorkType as List<DMCTimesheet.Models.C07_WorkType>;

    List<DMCTimesheet.Models.C03_ProjectMembers> AssignedProjects = ViewBag.AssignedProjects as List<DMCTimesheet.Models.C03_ProjectMembers>;

}
<div class="clearfix"></div>
<h2 class="text-primary">Danh mục dự án đang tham gia</h2>
<div class="form-group-lg">
    <table class="table table-bordered table-condensed">
        <caption class="text-primary">Số lượng dự án được giao <b class="text-danger">@myProject.Count()</b></caption>
        <thead class="table-dark">
            <tr class="row-fluid">
                <td class="col-md-2">Mã dự án</td>
                <td class="col-md-4">Tên dự án</td>
                <td class="col-md-3">Tên khác dự án</td>
                <td class="col-md-2">Ngày bắt đầu</td>
            </tr>
        </thead>
        <tbody class="text-dark">
            @if (myProject.Count() > 0)
            {
                foreach (DMCTimesheet.Models.C01_Projects item in myProject)
                {
                    <tr>
                        <td class="col-md-2">@item.ProjectID</td>
                        <td class="col-md-4"><b class="text-danger">@item.ProjectName</b></td>
                        <td class="col-md-3">@item.ProjectOtherName</td>
                        <td class="col-md-2">@item.StartDate</td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td class="row">Bạn chưa có dự án</td>
                </tr>
            }
        </tbody>
    </table>

</div>

<br />
<div class="clearfix"></div>

<div class="row inline">
    <h2 class="text-danger col-md-3">Danh sách công việc đã triển khai</h2>
    @* Modal create new *@
    <div class="col-md-offset-2">
        <button type="button" class="btn btn-info btn-small text-right8" data-toggle="modal" data-target="#newTimesheet"> <i class="fa fa-plus-circle"></i> Add</button>

    </div>
</div>
<div class="form-group-lg">
    <table class="table table-bordered">
        <thead class="table-dark text-white">
            <tr class="row-fluid">
                <td class="col-md-1">Ngày</td>
                <td class="col-md-2">Tên dự án</td>
                <td class="col-md-2">Loại công việc</td>
                <td class="col-md-1">Thời gian</td>
                <td class="col-md-1">Tăng ca</td>
                <td class="col-md-4">Chi tiết</td>
                <td class="col-md-1">#</td>
            </tr>
        </thead>
        <tbody class="text-dark">
            @if (myWorks.Count() == 0)
            {
                <tr>
                    <td class="row">Bạn chưa record công việc</td>
                </tr>
            }
            else
            {
                foreach (DMCTimesheet.Models.C08_Timesheet item in myWorks)
                {
                    <tr>
                        <td class="col-md-1">@DateTime.Parse(item.RecordDate.ToString()).ToShortDateString()</td>
                        <td class="col-md-2">@item.ProjectId - @myProject.FirstOrDefault(s => s.ProjectID == item.ProjectId).ProjectName</td>
                        <td class="col-md-2">@Worktype.FirstOrDefault(s => s.ID == item.WorkType).WorkName</td>
                        <td class="col-md-1">@item.Hour</td>
                        <td class="col-md-1">@item.OT</td>
                        <td class="col-md-4">@item.Description</td>
                        <td class="col-md-1">
                            @Html.ActionLink(" ", "UserEdit", "Timesheet", new { id = item.Id }, new { @class = "fa fa-edit btn" })
                            @Html.ActionLink(" ", "Delete", "Timesheet", new { id = item.Id }, new { @class = " fa fa-remove btn" })
                        </td>
                    </tr>
                }
            }


        </tbody>
    </table>

</div>

@* Model add Timesheet *@



@* Form nhập liệu *@
<div id="newTimesheet" class="modal fade" role="dialog">
    <div class="modal-dialog modal-m">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Thêm timesheet</h3>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                @using (Html.BeginForm("CreateTimesheet", "Timesheet", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    <form class="text-dark">
                        @* memberID *@
                        <div class="form-group row">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3 text-left">Tên thành viên</lable>
                            <input type="text" class="form-control col-md-7 col-sm-9 col-xs-9" readonly name="MemberName" placeholder="" required="" value="@loginUser.FullName" />
                        </div>

                        @* Date *@
                        <div class="form-group row">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3 text-left">Ngày ghi</lable>
                            <input type="date" class="form-control col-md-7 col-sm-9 col-xs-9" name="RecordDate" placeholder="" required="" value="@DateTime.Today.ToString("yyyy-MM-dd")" />
                        </div>
                        @* ProjectID *@
                        <div class="form-group row  text-left">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3">Dự án được phân công</lable>
                            <select name="ProjectId" required data-toggle="tooltip" data-placement="left" title="Dự án được phân công sẽ xuất hiện ở đây, vui lòng liên hệ Admin nếu chưa có dự án" class="form-control col-md-7 col-sm-9 col-xs-9">
                                @if (myProject != null || myProject.Count() > 0)
                                {
                                    foreach (var item in myProject)
                                    {
                                        <option value=@item.ProjectID>@myProject.FirstOrDefault(s => s.ProjectID == item.ProjectID).ProjectName</option>
                                    }
                                }
                            </select>
                        </div>

                        @* WorkType *@
                        <div class="form-group row  text-left">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3">Chọn Công việc</lable>
                            <select name="WorkID" required data-toggle="tooltip" data-placement="left" title="Chọn loại hình công việc của bạn" class="form-control col-md-7 col-sm-9 col-xs-9">
                                @foreach (var item in Worktype.GroupBy(s => s.WorkName))
                                {
                                    <option value=@Worktype.Where(s=>s.WorkName == item.Key).FirstOrDefault().ID>@item.Key</option>
                                }
                            </select>
                        </div>
                        @* Hour *@
                        <div class="form-group row text-left">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3">Thời gian</lable>
                            <div class="col-md-7 col-sm-9 col-xs-9">
                                <div class="col-md-6 text-success inline">
                                    <lable class="control-label col-md-5 text-left">Giờ</lable>
                                    <input type="number" class="form-control col-md-6" name="Hour" required value="4" />
                                </div>
                                <div class="col-md-6 text-danger inline">
                                    <lable class="control-label col-md-6 text-left">Tăng ca</lable>
                                    <input type="number" class="form-control col-md-6" name="OvertimeHour" value="0" />
                                </div>
                            </div>
                        </div>
                        @* Description *@
                        <div class="form-group row">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3 text-left">Ghi chú chi tiết</lable>
                            <textarea class="form-control col-md-7 col-sm-9 col-xs-9 " rows="3" name="Description" placeholder="Nhập ngắn gọn nội dung công việc" required></textarea>
                        </div>
                        <div class="form-group text-left">
                            <lable class="control-label col-md-3 col-sm-3 col-xs-3 text-left"></lable>
                            <input type="submit" value="Save" class="btn btn-success col-md-7" />

                        </div>

                        <div>
                            <p class="text-danger">@ViewBag.WorkAlert</p>
                        </div>
                        <div class="clearfix"></div>
                    </form>
                }
            </div>           
        </div>

    </div>
</div>
</div>
@* End Form nhập liệu *@
