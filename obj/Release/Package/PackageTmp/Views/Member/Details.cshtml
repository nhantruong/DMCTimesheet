@model DMCTimesheet.Models.C02_Members
@{
    DMCTimesheet.Models.C06_UserPermisRelationship Userpermiss = Session["UserPermission"] as DMCTimesheet.Models.C06_UserPermisRelationship;
    ViewBag.Title = "Cập nhật thông tin thành viên";
    //Layout = "~/Views/Shared/_AdminLayout.cshtml";

    DMCTimesheet.Models.C02_Members loginUser = Session["UserLogin"] as DMCTimesheet.Models.C02_Members;
    string imgPath = "~/Assets/Photos/MemberImage/";
    try
    {
        if (loginUser == null)
        {
            imgPath = "~/Assets/Photos/MemberImage/no-image.jpg";
        }
        else
        {
            imgPath = "~/Assets/Photos/MemberImage/" + Model.Image;
        }

    }
    catch (Exception)
    {
        imgPath = "~/Assets/Photos/MemberImage/no-image.jpg";
    }
    //Data from controller
    List<DMCTimesheet.Models.C17_Position> Positions = ViewBag.Position as List<DMCTimesheet.Models.C17_Position>;
    List<DMCTimesheet.Models.C18_Descipline> desciplines = ViewBag.Descipline as List<DMCTimesheet.Models.C18_Descipline>;
    List<DMCTimesheet.Models.C01_Projects> myProject = ViewBag.myProject as List<DMCTimesheet.Models.C01_Projects>;
}
<div class="nav navbar-fixed-top row">
    @Html.ActionLink(" Home", "Index", "Member", null, new { @class = "fa fa-home btn btn-round btn-dark" })
</div>

<h3>@ViewBag.Title</h3>

<div class="form-group">
    <div class="col-md-3">
        <div class="container">
            <img src="@Url.Content(imgPath)" class="img-fluid k-content-frame">
        </div>
    </div>
    <div class="col-md-9">
        <div class="modal-body">
            @using (Html.BeginForm("Details", "Member", FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                <form>
                    @* WorkType *@
                    <div class="form-group row text-left">
                        <lable hidden class="control-label col-sm-3 col-sm-3 col-xs-3">User ID</lable>
                        <input hidden type="number" class="form-control col-sm-7 col-sm-9 col-xs-9" name="UserID" readonly value="@Model.UserID" />
                    </div>
                    <div class="form-group row text-left">
                        <lable class="control-label col-sm-3 col-sm-3 col-xs-3">Tên đầy đủ</lable>
                        <input type="text" class="form-control col-sm-7 col-sm-9 col-xs-9" name="FullName" placeholder="Tên đầy đủ" required="" value="@Model.FullName" />
                    </div>

                    <div class="form-group row text-left">
                        <lable class="control-label col-sm-3 col-sm-3 col-xs-3">Username</lable>
                        <input type="text" class="form-control col-sm-7 col-sm-9 col-xs-9" name="UserName" placeholder="Tên theo email xxx@coteccons.vn" required="" value="@Model.UserName" />
                    </div>

                    <div class="form-group row">
                        <lable class="control-label col-sm-3 col-sm-3 col-xs-3 text-left">Email</lable>
                        <input type="email" class="form-control col-sm-7 col-sm-9 col-xs-9" name="Email" placeholder="" value="@Model.Email" />
                    </div>

                    @* PositionID *@
                    <div class="form-group row  text-left">
                        <lable class="control-label col-sm-3 col-sm-3 col-xs-3">Chức vụ</lable>
                        <select name="Position" class="form-control col-sm-7 col-sm-9 col-xs-9">
                            <option value=@Model.Position>@Positions.FirstOrDefault(s => s.Id == Model.Position).PositionName</option>
                            @foreach (var item in Positions)
                            {
                                <option value=@item.Id>@item.PositionName</option>
                            }
                        </select>
                    </div>

                    @* Chuyen Mon ID *@
                    <div class="form-group row  text-left">
                        <lable class="control-label col-sm-3 col-sm-3 col-xs-3">Chuyên môn</lable>
                        <select name="Descipline" class="form-control col-sm-7 col-sm-9 col-xs-9">
                            <option value=@Model.Descipline>@desciplines.FirstOrDefault(s => s.Id == Model.Descipline).DesciplineName</option>
                            @foreach (var item in desciplines)
                            {
                                <option value=@item.Id>@item.DesciplineName</option>
                            }
                        </select>
                    </div>

                    <div class="form-group text-left">
                        <lable class="control-label col-sm-3 col-sm-3 col-xs-3 text-left"></lable>
                        <input type="submit" value="Cập nhật" class="btn btn-success col-sm-2" />
                    </div>
                </form>
            }
        </div>
    </div>
</div>
<div class="clearfix"></div>
<br />
<hr />
<h5 class="text-primary">Danh sách dự án đang tham gia</h5>
<div class="form-group">
    <div>
        <table class="table table-hover table-condensed table-striped ">
            <thead class="table-dark">
                <tr>
                    <td class="col-md-1 text-center">Năm</td>
                    <td class="col-md-1">Ngày bắt đầu</td>
                    <td class="col-md-1">Mã dự án</td>
                    <td class="col-md-4">Tên rút gọn</td>
                </tr>
            </thead>
        </table>
    </div>
    <div class="table-responsive" style="height: 600px">
        <table class="table table-hover table-condensed table-striped ">
            <caption>Số lượng dự án đang tiến hành: <b class="text-danger">@myProject.Where(s => s.ProjectStage != 5).Count()</b></caption>
            <tbody>
                @if (myProject == null || myProject.Count() == 0)
                {
                    <tr class="row">
                        <td>Chưa có dự án được giao</td>
                    </tr>
                }
                else
                {
                    foreach (var item in myProject.Where(s => s.ProjectStage != 5).OrderByDescending(m => m.MaDuAn).ThenBy(p => p.ProjectOtherName))
                    {
            <tr class="row text-dark">
                <td class="col-md-1 text-center">@item.Year</td>
                <td class="col-md-1">@DateTime.Parse(item.StartDate.ToString()).ToShortDateString()</td>
                <td class="col-md-1">
                    <div class="inline">
                        <b>@Html.ActionLink(item.MaDuAn.ToString(), "Edit", "Project", new { id = item.ProjectID }, new { @class = "text-primary" })</b>
                    </div>
                </td>
                <td class="col-md-4"><b>@Html.ActionLink(item.ProjectOtherName, "Edit", "Project", new { id = item.ProjectID }, new { @class = "text-primary" })</b></td>
            </tr>
                    }
                }

            </tbody>
        </table>
    </div>

    <br />
</div>



<div class="modal-footer">
    <div>
        <p class="text-danger">@ViewBag.Error</p>
    </div>
    <div class="clearfix"></div>
</div>