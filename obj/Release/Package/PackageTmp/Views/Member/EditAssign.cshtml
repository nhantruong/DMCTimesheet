@model DMCTimesheet.Models.C03_ProjectMembers
@{
    ViewBag.Title = "Project Assignment edit";
    //Layout = "~/Views/Shared/_AdminLayout.cshtml";
    //Thông tin từ Controller gửi lên
    List<DMCTimesheet.Models.C01_Projects> Projects = ViewBag.Projects as List<DMCTimesheet.Models.C01_Projects>;
    List<DMCTimesheet.Models.C02_Members> _Members = ViewBag.Members as List<DMCTimesheet.Models.C02_Members>;
    List<DMCTimesheet.Models.C02_Members> Members = _Members.OrderBy(s => s.FullName).ToList();
    List<DMCTimesheet.com.cbimtech.MemberServices.MemberOutput> BIMer = ViewBag.BIMer as List<DMCTimesheet.com.cbimtech.MemberServices.MemberOutput>;

    List<DMCTimesheet.Models.C02_Members> chuyenCongTac = new List<DMCTimesheet.Models.C02_Members>();
    chuyenCongTac = _Members.Where(s => s.Deactived == true).ToList();
    //string Error = Session["MemberAssignError"] as string ?? "";
}
@*<h3><i>@Error</i></h3>*@
<div>
    <h3>ĐIỀU CHỈNH THÔNG TIN ĐIỀU PHỐI CHO DỰ ÁN <b class="text-danger">@Projects.FirstOrDefault(s => s.ProjectID == Model.ProjectID).ProjectOtherName</b></h3>
</div>
<div class="modal-body">
    @using (Html.BeginForm("EditAssignMember", "Member", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
    <form>
        <div class="form-group row">
            <lable hidden class="control-label col-md-3 col-sm-3 col-xs-3 text-left">Mã điều phối</lable>
            <input hidden type="number" class="form-control col-md-7 col-sm-9 col-xs-9" name="ID" placeholder="" readonly="" value="@Model.ID" />
        </div>

        <div class="form-group row">
            <lable class="control-label col-md-3 col-sm-3 col-xs-3 text-left">Ngày điều phối</lable>
            <input type="date" class="form-control col-md-7 col-sm-9 col-xs-9" name="Ngay" placeholder="" required="" value="@DateTime.Parse(Model.Ngay.ToString()).ToString("yyyy-MM-dd")" />
        </div>
        @* ProjectTypeID *@
        <div class="form-group row  text-left">
            <lable hidden class="control-label col-md-3 col-sm-3 col-xs-3"><b class="text-danger">Tên dự án</b></lable>
            <input hidden type="number" name="ProjectID" value="@Model.ProjectID" />
        </div>
        @* ARC ID *@
        <div class="form-group row  text-left">
            <lable class="control-label col-md-3 col-sm-3 col-xs-3"><b>Chủ trì Dự án</b></lable>
            <select name="ChuTriChinh" class="form-control col-md-7 col-sm-9 col-xs-9">
                @if (@Model.ChuTriChinh != null)
                {
                    <option value="@Model.ChuTriChinh">@Members.FirstOrDefault(s => s.UserID == Model.ChuTriChinh).FullName</option>
                }
                <option value=""></option>
                @foreach (var item in Members.OrderBy(s => s.FullName))
                {
                    <option value=@item.UserID>@item.FullName</option>
                }
            </select>
        </div>
        @* Architecture ID *@
        <div class="form-group row  text-left">
            <lable class="control-label col-md-3 col-sm-3 col-xs-3"><b class="text-primary">Chủ trì bộ môn Kiến trúc</b></lable>
            <select name="ChuTriKienTruc" class="form-control col-md-7 col-sm-9 col-xs-9">
                @if (@Model.ChuTriKienTruc != null)
                {
                    <option value="@Model.ChuTriKienTruc">@Members.FirstOrDefault(s => s.UserID == Model.ChuTriKienTruc).FullName</option>
                }
                <option value=""></option>
                @foreach (var item in Members.Where(s => s.Descipline == 1).OrderBy(s => s.FullName))
                {
                    <option value=@item.UserID>@item.FullName</option>
                }
            </select>
        </div>
        @* Structure ID *@
        <div class="form-group row  text-left">
            <lable class="control-label col-md-3 col-sm-3 col-xs-3"><b class="text-primary">Chủ trì bộ môn Kết cấu</b></lable>
            <select name="ChuTriKetCau" class="form-control col-md-7 col-sm-9 col-xs-9">
                @if (@Model.ChuTriKetCau != null)
                {
                    <option value="@Model.ChuTriKetCau">@Members.FirstOrDefault(s => s.UserID == Model.ChuTriKetCau).FullName</option>
                }
                <option value=""></option>
                @foreach (var item in Members.Where(s => s.Descipline == 2).OrderBy(s => s.FullName).OrderBy(s => s.FullName))
                {
                    <option value=@item.UserID>@item.FullName</option>
                }
            </select>
        </div>

        @* MEP ID *@
        <div class="form-group row  text-left">
            <lable class="control-label col-md-3 col-sm-3 col-xs-3"><b class="text-primary">Chủ trì bộ môn Cơ điện - MEPF</b></lable>
            <select name="ChuTriMEP" class="form-control col-md-7 col-sm-9 col-xs-9">
                @if (@Model.ChuTriMEP != null)
                {
                    <option value="@Model.ChuTriMEP">@Members.FirstOrDefault(s => s.UserID == Model.ChuTriMEP).FullName</option>
                }
                <option value=""></option>
                @foreach (var item in Members.Where(s => s.Descipline == 3).OrderBy(s => s.FullName))
                {
                    <option value=@item.UserID>@item.FullName</option>
                }
            </select>
        </div>

        @* Legal ID *@
        <div class="form-group row  text-left">
            <lable class="control-label col-md-3 col-sm-3 col-xs-3"><b class="text-primary">Pháp lý</b></lable>
            <select name="LegalManager" class="form-control col-md-7 col-sm-9 col-xs-9">
                @if (@Model.LegalManager != null)
                {
                    <option value="@Model.LegalManager">@Members.FirstOrDefault(s => s.UserID == Model.LegalManager).FullName</option>
                }
                <option value=""></option>
                @foreach (var item in Members.OrderBy(s => s.FullName))
                {
                    <option value=@item.UserID>@item.FullName</option>
                }
            </select>
        </div>

        @* Thành viên khác *@
    <div class="form-group row  text-left">
        <lable class="control-label col-sm-3 col-sm-3 col-xs-3"><b class="text-primary">Thành viên khác</b></lable>
        @{
            System.Text.StringBuilder sb = new System.Text.StringBuilder();
            var tvk = Model.ThanhVienKhac.Split(',');
            foreach (var item in tvk)
            {
                int uId = int.Parse(item);
                sb.Append($" {Members.FirstOrDefault(s => s.UserID == uId).FullName};");
                
            }
                <textarea type="text" readonly class="form-control col-sm-7 col-sm-7 col-xs-9" name="ThanhVienKhac" value="" id="Thanhvien_Khac">@sb.ToString()</textarea>
        }
    </div>

        <div class="form-group col-lg-offset-1">
            <label class="text-lg-center text-primary"><b>Chọn thành viên bổ sung</b></label>
            <div class="form-group col-md-12">
                <div class="col-md-3 form-check">

                    <b class="text-danger">Kiến trúc</b>
                    <div class="form-check">
                        @{
                            int i = 1;
                            foreach (var item in Members.Where(s => s.Descipline == 1 && s.SystemMember == false && s.Deactived == false).OrderBy(s => s.UserName))
                            {
                                string chkname = string.Concat("chk", i);
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="@item.UserID" value="@item.FullName" id="@chkname" onchange="addData(this,'@item.FullName')" />
                                    <label class="form-check-label" for="@chkname">@item.FullName</label>
                                </div>
                                i++;
                            }
                        }
                    </div>
                </div>
                <div class="col-md-3 form-check">
                    <b class="text-danger">Kết cấu</b>
                    <div class="form-check">
                        @{
                            int j = i + 1;
                            foreach (var item in Members.Where(s => s.Descipline == 2 && s.SystemMember == false && s.Deactived == false).OrderBy(s => s.UserName))
                            {
                                string chkname = string.Concat("chk", j);
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="@item.UserID" value="@item.FullName" id="@chkname" onchange="addData(this,'@item.FullName')" />
                                    <label class="form-check-label" for="@chkname">@item.FullName</label>
                                </div>
                                j++;
                            }
                        }
                    </div>
                </div>
                <div class="col-md-3 form-check">
                    <b class="text-danger">MEPF</b>
                    <div class="form-check">
                        @{
                            int k = j + 1;
                            foreach (var item in Members.Where(s => s.Descipline == 3 && s.SystemMember == false && s.Deactived == false).OrderBy(s => s.UserName))
                            {
                                string chkname = string.Concat("chk", k);
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="@item.UserID" value="@item.FullName" id="@chkname" onchange="addData(this,'@item.FullName')" />
                                    <label class="form-check-label" for="@chkname">@item.FullName</label>
                                </div>
                                k++;
                            }
                        }
                    </div>
                </div>
                <div class="col-md-3 form-check">
                    <b class="text-danger">Khác</b>
                    <div class="form-check">
                        @{
                            int l = k + 1;
                            foreach (var item in Members.Where(s => s.Descipline > 3 && s.SystemMember == false && s.Deactived == false).OrderBy(s => s.UserName))
                            {
                                string chkname = string.Concat("chk", l);
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" name="@item.UserID" value="@item.FullName" id="@chkname" onchange="addData(this,'@item.FullName')" />
                                    <label class="form-check-label" for="@chkname">@item.FullName</label>
                                </div>
                                l++;
                            }
                        }
                    </div>
                </div>
            </div>

        </div>


        <hr />
        <div class="clearfix"></div>

        <br />
        <div class="form-group text-left">
            <lable class="control-label col-md-3 col-sm-3 col-xs-3 text-left"></lable>
            <input type="submit" value="Save" class="btn btn-outline-dark col-md-1" />
        </div>
    </form>
    }
</div>
<div class="modal-footer">
    <div>
        <p class="text-danger">@ViewBag.Error</p>
    </div>
    <div class="clearfix"></div>
</div>