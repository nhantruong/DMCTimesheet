@model IEnumerable<DMCTimesheet.Models.C08_Timesheet>
@{
    DMCTimesheet.Models.C06_UserPermisRelationship Userpermiss = Session["UserPermission"] as DMCTimesheet.Models.C06_UserPermisRelationship;

    DMCTimesheet.Models.C02_Members loginUser = Session["UserLogin"] as DMCTimesheet.Models.C02_Members;
    int stt = 0;
    List<DMCTimesheet.Models.C02_Members> Members = ViewBag.Members as List<DMCTimesheet.Models.C02_Members>;
    List<DMCTimesheet.Models.C01_Projects> Projects = ViewBag.Projects as List<DMCTimesheet.Models.C01_Projects>;
    List<DMCTimesheet.Models.C07_WorkType> Works = ViewBag.WorkGroup as List<DMCTimesheet.Models.C07_WorkType>;
    List<DMCTimesheet.Models.C03_ProjectMembers> MyProjects = ViewBag.ProjectMember as List<DMCTimesheet.Models.C03_ProjectMembers>;
    
}


@* Danh sách Timesheet đã làm *@
@*<h3 class="text-danger">@ViewBag.WorkAlert</h3>*@
<div class="row">
    <div class="col-md-12">
        @* Form tạo timesheet *@
        <div class="col-md-5">
            <div class="x_panel">
                <div class="x_title">
                    <h2 class="text-warning"><b class="text-success">Dailywork</b></h2>
                    <ul class="nav navbar-right panel_toolbox">
                        <li>
                            <a class="collapse-link"><i class="fa fa-chevron-up text-primary"></i></a>
                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>
                <div class="x_content">
                    @* Form nhập liệu *@
                    <div>
                        @using (Html.BeginForm("CreateTimesheet", "Timesheet", FormMethod.Post))
                        {
                            @Html.AntiForgeryToken()
                            <form class="text-dark">
                                <h2 class="text-left text-danger">Add daily work</h2>
                                <div class="clearfix"></div>
                                @* memberID *@
                                <div class="form-group row">
                                    <lable class="control-label col-md-3 col-sm-3 col-xs-3 text-left">Tên thành viên</lable>
                                    <input type="text" class="form-control col-md-7 col-sm-9 col-xs-9" readonly name="MemberName" placeholder="" required="" value="@loginUser.FullName" />
                                </div>

                                @* Date *@
                                <div class="form-group row">
                                    <lable class="control-label col-md-3 col-sm-3 col-xs-3 text-left">Ngày ghi</lable>
                                    <input type="date" class="form-control col-md-7 col-sm-9 col-xs-9" name="RecordDate" placeholder="" required="" value="@DateTime.Today.ToString("yyyy-MM-dd")" />
                                </div>
                                @* ProjectID *@
                                <div class="form-group row  text-left">
                                    <lable class="control-label col-md-3 col-sm-3 col-xs-3">Dự án được phân công</lable>
                                    <select name="ProjectId" required data-toggle="tooltip" data-placement="left" title="Dự án được phân công sẽ xuất hiện ở đây, vui lòng liên hệ Admin nếu chưa có dự án" class="form-control col-md-7 col-sm-9 col-xs-9">
                                        @if (MyProjects != null || MyProjects.Count() > 0)
                                        {
                                            foreach (var item in MyProjects.OrderBy(s => s.Ngay))
                                            {
                                                <option value=@item.ProjectID>@Projects.FirstOrDefault(s => s.ProjectID == item.ProjectID).ProjectOtherName</option>
                                            }
                                        }
                                    </select>
                                </div>

                                @* WorkType *@
                                <div class="form-group row  text-left">
                                    <lable class="control-label col-md-3 col-sm-3 col-xs-3">Chọn Công việc</lable>
                                    <select name="WorkID" required data-toggle="tooltip" data-placement="left" title="Chọn loại hình công việc của bạn" class="form-control col-md-7 col-sm-9 col-xs-9">
                                        @foreach (var item in Works.OrderBy(s=>s.WorkGroup))
                                        {
                                            <option value=@item.ID>@item.WorkName</option>
                                        }
                                    </select>
                                </div>
                                @* Hour *@
                                <div class="form-group row text-left">
                                    <lable class="control-label col-md-3 col-sm-3 col-xs-3">Thời gian</lable>
                                    <div class="col-md-7 col-sm-9 col-xs-9">
                                        <div class="col-md-6 text-success inline">
                                            <lable class="control-label col-md-5 text-left">Giờ</lable>
                                            <input type="number" class="form-control col-md-6" name="Hour" required value="4" />
                                        </div>
                                        <div class="col-md-6 text-danger inline">
                                            <lable class="control-label col-md-6 text-left">Tăng ca</lable>
                                            <input type="number" class="form-control col-md-6" name="OvertimeHour" value="0" />
                                        </div>
                                    </div>
                                </div>
                                @* Description *@
                                <div class="form-group row">
                                    <lable class="control-label col-md-3 col-sm-3 col-xs-3 text-left">Ghi chú chi tiết</lable>
                                    <textarea class="form-control col-md-7 col-sm-9 col-xs-9 " rows="3" name="Description" placeholder="Nhập ngắn gọn nội dung công việc" required></textarea>
                                </div>
                                <div class="form-group text-left">
                                    <lable class="control-label col-md-3 col-sm-3 col-xs-3 text-left"></lable>
                                    <input type="submit" value="Save" class="btn btn-success col-md-7" />
                                </div>

                                <div class="clearfix"></div>

                            </form>
                        }
                    </div>
                    <div class="text-center">
                        <h4 class="text-danger">@ViewBag.WorkAlert</h4>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-7">
            <div class="row">
                <div class="x_panel">
                    <div class="x_title">
                        <h2 class="text-warning"><b class="text-success">Daily Timesheet record</b></h2>
                        <ul class="nav navbar-right panel_toolbox">
                            <li>
                                <a class="collapse-link"><i class="fa fa-chevron-up text-primary"></i></a>
                            </li>
                        </ul>
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                        <div class="x_content table-responsive">
                            <div id="ajax-loader"></div>
                            <p>Công việc trong ngày - <b class="text-primary">@DateTime.Today.ToShortDateString()</b></p>
                            <table class="table table-hover table-bordered table-striped">
                                @*<caption><h6>Tổng số giờ trong trong ngày <b class="text-danger"></b></h6></caption>*@
                                <thead class="bg-dark text-center text-white">
                                    <tr>
                                        <th>No</th>
                                        <th>Record date</th>
                                        <th>Project</th>
                                        <th>Workdone</th>
                                        <th>Hours</th>
                                        <th>Overtime</th>
                                        <th>Description</th>
                                        <th>#</th>
                                    </tr>
                                </thead>
                                <tbody id="seachResult" class="text-dark">
                                    @if (Model != null)
                                    {
                                        foreach (var item in Model.OrderByDescending(s=>s.RecordDate))
                                        {
                                            stt++;
                                            <tr>
                                                <td>@stt</td>
                                                <td>@DateTime.Parse(item.RecordDate.ToString()).ToShortDateString()</td>
                                                <td>@item.ProjectId - @Projects.FirstOrDefault(s => s.ProjectID == item.ProjectId).ProjectOtherName</td>
                                                <td>@Works.FirstOrDefault(s => s.ID == item.WorkType).WorkName</td>
                                                <td>@item.Hour</td>
                                                <td>@item.OT</td>
                                                <td>@item.Description</td>
                                                <td>
                                                    @Html.ActionLink(" ", "UserEdit", "Timesheet", new { id = item.Id }, new { @class = "fa fa-edit btn" })
                                                    @Html.ActionLink(" ", "Delete", "Timesheet", new { id = item.Id }, new { @class = " fa fa-remove btn" })
                                                </td>
                                            </tr>
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td class="row text-danger">Hôm nay chưa có công việc nào được ghi nhận</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="clearfix"></div>
